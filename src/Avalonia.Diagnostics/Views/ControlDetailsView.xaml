<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:vm="clr-namespace:Avalonia.Diagnostics.ViewModels"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="Avalonia.Diagnostics.Views.ControlDetailsView"
             Design.Width="800"
             xmlns:v="clr-namespace:Avalonia.Diagnostics.Views;assembly=Avalonia.Diagnostics">
  <UserControl.Styles>
    <Style Selector="TextBox.editor[IsReadOnly=True]">
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="TextBox.editor[IsReadOnly=True]">
      <Setter Property="BorderThickness" Value="0" />
    </Style>
    <Style Selector="AutoCompleteBox.editor">
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="AutoCompleteBox.editor[IsEnabled=False]">
      <Setter Property="BorderThickness" Value="0" />
    </Style>
  </UserControl.Styles>
  <Grid RowDefinitions="Auto,*">
    <Grid x:Name="headerGrid" ColumnDefinitions="200,4,1*,4,100,20" Grid.Row="0" Background="{DynamicResource ThemeBorderMidBrush}">
      <Grid.Styles>
        <Style Selector="TextBlock.header">
          <Setter Property="Foreground" Value="{DynamicResource ThemeControlMidBrush}" />
          <Setter Property="HorizontalAlignment" Value="Center" />
          <Setter Property="Margin" Value="4" />
          <Setter Property="FontSize" Value="14" />
        </Style>
      </Grid.Styles>
      <TextBlock Classes="header"  Text="Property" Grid.Column="0" />
      <TextBlock Classes="header" Text="Value" Grid.Column="2" />
      <TextBlock Classes="header" Text="Priority" Grid.Column="4" />
      <GridSplitter Grid.Column="1"/>
      <GridSplitter Grid.Column="3"/>
    </Grid>
    <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Disabled">
      <ItemsRepeater Items="{Binding Properties}" Tag="{Binding #headerGrid.ColumnDefinitions}">
        <ItemsRepeater.ItemTemplate>
          <DataTemplate>
            <Grid HorizontalAlignment="Stretch">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{Binding $parent[ItemsRepeater].Tag[0].Width}" />
                <ColumnDefinition Width="4" />
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="4" />
                <ColumnDefinition Width="{Binding $parent[ItemsRepeater].Tag[4].Width}" />
              </Grid.ColumnDefinitions>
              <Panel Background="Transparent" Grid.Column="0"  ToolTip.Tip="{Binding Diagnostic}" >
                <TextBlock Text="{Binding Name}"  Margin="5 0 0 0" VerticalAlignment="Center" />
              </Panel>
              <Panel Grid.Column="2">
                <Border BorderBrush="Orange" BorderThickness="1" IsVisible="{Binding IsChanged}" />

                <AutoCompleteBox IsEnabled="{Binding !IsReadOnly}" Classes="editor" Margin="1"
                                    DataValidationErrors.Errors="{Binding ValueErrors}"
                                    IsTextCompletionEnabled="{Binding !IsReadOnly}"
                                    AsyncPopulator="{Binding PossibleValuesPopulator}"
                                  >
                  <v:BindingHelper.BindBackOnEvent>
                    <v:BindingHelper Binding="{Binding Value, Mode=TwoWay}"  EventNames="LostFocus,DropDownClosed" PropertyName="Text" />
                  </v:BindingHelper.BindBackOnEvent>
                </AutoCompleteBox>
              </Panel>

              <!--<TextBox IsReadOnly="{Binding IsReadOnly}" Classes="editor"
                                     Text="{Binding Value, Mode=TwoWay}"
                                     Grid.Column="1" />-->

              <TextBlock Text="{Binding Priority}" Margin="5 0 0 0" Grid.Column="4" VerticalAlignment="Center" />
            </Grid>
          </DataTemplate>
        </ItemsRepeater.ItemTemplate>
      </ItemsRepeater>
    </ScrollViewer>
  </Grid>
</UserControl>
